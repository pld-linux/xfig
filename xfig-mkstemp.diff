diff -ur xfig.3.2.3d.orig/f_readeps.c xfig.3.2.3d/f_readeps.c
--- xfig.3.2.3d.orig/f_readeps.c	Wed Apr 18 01:12:24 2001
+++ xfig.3.2.3d/f_readeps.c	Fri Mar 22 10:10:16 2002
@@ -251,7 +251,7 @@
     char        buf[300];
     FILE       *tmpfp, *pixfile, *gsfile;
     char       *psnam, *driver;
-    int         status, wid, ht, nbitmap;
+    int         status, wid, ht, nbitmap, fd;
     char        tmpfile[PATH_MAX],
 		pixnam[PATH_MAX],
 		errnam[PATH_MAX],
@@ -273,8 +273,12 @@
 	/* re-open the pipe */
 	close_picfile(file, filetype);
 	file = open_picfile(file, &filetype, PIPEOK, pixnam);
-	sprintf(tmpfile, "%s/%s%06d", TMPDIR, "xfig-eps", getpid());
-	if ((tmpfp = fopen(tmpfile, "wb")) == NULL) {
+	snprintf(tmpfile, sizeof(tmpfile), "%s/xfig-eps.XXXXXX", TMPDIR);
+	if ((fd = mkstemp(tmpfile)) == -1 || (tmpfp = fdopen(fd, "wb")) == NULL) {
+		if (fd != -1) {
+			unlink(tmpfile);
+			close(fd);
+		}
 	    file_msg("Couldn't open tmp file %s, %s", tmpfile, strerror(errno));
 	    return False;
 	}
@@ -283,9 +287,21 @@
 	fclose(tmpfp);
     }
     /* make name /TMPDIR/xfig-pic.pix */
-    sprintf(pixnam, "%s/%s%06d.pix", TMPDIR, "xfig-pic", getpid());
+	snprintf(pixnam, sizeof(pixnam), "%s/xfig-pic.XXXXXX", TMPDIR);
+	if ((fd = mkstemp(pixnam)) == -1) {
+	    file_msg("Couldn't open tmp file %s, %s", pixnam, strerror(errno));
+	    return False;
+	}
+	close(fd);
+
     /* and file name for any error messages from gs */
-    sprintf(errnam, "%s/%s%06d.err", TMPDIR, "xfig-pic", getpid());
+    snprintf(errnam, sizeof(errnam), "%s/xfig-picerr.XXXXXX", TMPDIR);
+	if ((fd = mkstemp(errnam)) == -1) {
+	    file_msg("Couldn't open tmp file %s, %s", errnam, strerror(errno));
+	    return False;
+	}
+	close(fd);
+
     /* generate gs command line */
     /* for monochrome, use pbm */
     if (tool_cells <= 2 || appres.monochrome) {
diff -ur xfig.3.2.3d.orig/f_readgif.c xfig.3.2.3d/f_readgif.c
--- xfig.3.2.3d.orig/f_readgif.c	Tue Feb 27 23:37:53 2001
+++ xfig.3.2.3d/f_readgif.c	Fri Mar 22 09:42:59 2002
@@ -75,7 +75,7 @@
 	char		buf[BUFLEN],pcxname[PATH_MAX];
 	FILE		*giftopcx;
 	struct Cmap 	localColorMap[MAX_COLORMAP_SIZE];
-	int		i, stat, size;
+	int		i, stat, size, fd;
 	int		useGlobalColormap;
 	unsigned int	bitPixel, red, green, blue;
 	unsigned char	c;
@@ -172,7 +172,13 @@
 	/* now call giftopnm and ppmtopcx */
 
 	/* make name for temp output file */
-	sprintf(pcxname, "%s/%s%06d.pix", TMPDIR, "xfig-pcx", getpid());
+	snprintf(pcxname, sizeof(pcxname), "%s/xfig-pcx.XXXXXX", TMPDIR);
+	if ((fd = mkstemp(pcxname)) == -1) {
+		file_msg("Cannot create temporary file\n");
+		return FileInvalid;
+	}
+	close(fd);
+
 	/* make command to convert gif to pcx into temp file */
 	sprintf(buf, "giftopnm | ppmtopcx > %s 2> /dev/null", pcxname);
 	if ((giftopcx = popen(buf,"w" )) == 0) {
diff -ur xfig.3.2.3d.orig/f_readppm.c xfig.3.2.3d/f_readppm.c
--- xfig.3.2.3d.orig/f_readppm.c	Tue Feb 27 23:37:39 2001
+++ xfig.3.2.3d/f_readppm.c	Fri Mar 22 15:38:02 2002
@@ -32,10 +32,16 @@
 {
 	char	 buf[BUFLEN],pcxname[PATH_MAX];
 	FILE	*giftopcx;
-	int	 stat, size;
+	int	 stat, size, fd;
 
 	/* make name for temp output file */
-	sprintf(pcxname, "%s/%s%06d.pix", TMPDIR, "xfig-pcx", getpid());
+	snprintf(pcxname, sizeof(pcxname), "%s/xfig-pcx.XXXXXX", TMPDIR);
+	if ((fd = mkstemp(pcxname)) == -1) {
+	    file_msg("Cannot open temp file %s: %s\n", pcxname, strerror(errno));
+	    return FileInvalid;
+	}
+	close(fd);
+
 	/* make command to convert gif to pcx into temp file */
 	sprintf(buf, "ppmtopcx > %s 2> /dev/null", pcxname);
 	if ((giftopcx = popen(buf,"w" )) == 0) {
diff -ur xfig.3.2.3d.orig/f_readtif.c xfig.3.2.3d/f_readtif.c
--- xfig.3.2.3d.orig/f_readtif.c	Tue Feb 27 23:37:11 2001
+++ xfig.3.2.3d/f_readtif.c	Fri Mar 22 15:38:24 2002
@@ -32,11 +32,16 @@
 {
 	char	 buf[2*PATH_MAX+40],pcxname[PATH_MAX];
 	FILE	*tiftopcx;
-	int	 stat;
+	int	 stat, fd;
 
 	/* make name for temp output file */
-	sprintf(pcxname, "%s/%s%06d.pix", TMPDIR, "xfig-pcx", getpid());
-
+	snprintf(pcxname, sizeof(pcxname), "%s/xfig-pcx.XXXXXX", TMPDIR);
+	if ((fd = mkstemp(pcxname)) == -1) {
+	    file_msg("Cannot open temp file %s: %s\n", pcxname, strerror(errno));
+		return FileInvalid;
+	}
+	close(fd);
+	
 	/* make command to convert tif to pnm then to pcx into temp file */
 	/* for some reason, tifftopnm requires a file and can't work in a pipe */
 	sprintf(buf, "tifftopnm %s 2> /dev/null | ppmtopcx > %s 2> /dev/null",
diff -ur xfig.3.2.3d.orig/f_util.c xfig.3.2.3d/f_util.c
--- xfig.3.2.3d.orig/f_util.c	Fri Mar 30 20:22:37 2001
+++ xfig.3.2.3d/f_util.c	Fri Mar 22 11:28:52 2002
@@ -1056,14 +1056,20 @@
     char	*name;
 {
     char    line[RC_BUFSIZ+1], *tok;
+	int fd;
 
     /* make a temp filename in the user's home directory so we
        can just rename it to .xfigrc after creating it */
-    sprintf(tmpname, "%s/%s%06d", userhome, "xfig-xfigrc", getpid());
-    tmpf = fopen(tmpname,"wb");
-    if (tmpf == 0) {
-	file_msg("Can't make temporary file for .xfigrc - error: %s",strerror(errno));
-	return -1;	
+    snprintf(tmpname, sizeof(tmpname), "%s/xfig-xfigrc.XXXXXX", userhome);
+
+	if ((fd = mkstemp(tmpname)) == -1 || (tmpf = fdopen(fd, "wb")) == NULL) {
+		file_msg("Can't make temporary file for .xfigrc - error: %s",
+				 strerror(errno));
+		if (fd != -1) {
+			unlink(tmpname);
+			close(fd);
+		}
+		return -1;
     }
     /* read the .xfigrc file and write all to temp file except file names */
     xfigrc = fopen(xfigrc_name,"r");
diff -ur xfig.3.2.3d.orig/main.c xfig.3.2.3d/main.c
--- xfig.3.2.3d.orig/main.c	Thu Jan 25 23:49:19 2001
+++ xfig.3.2.3d/main.c	Fri Mar 22 15:35:34 2002
@@ -663,8 +663,10 @@
     get_directory(orig_dir);
 
     /* get the TMPDIR environment variable for temporary files */
-    if ((TMPDIR = getenv("XFIGTMPDIR"))==NULL)
-	TMPDIR = "/tmp";
+    if ((TMPDIR = getenv("XFIGTMPDIR"))==NULL) {
+		if ((TMPDIR = getenv("TMPDIR")) == NULL)
+			TMPDIR = "/tmp";
+	}
 
     /* install actions to get to the functions with accelerators */
     XtAppAddActions(tool_app, main_actions, XtNumber(main_actions));
@@ -696,7 +698,14 @@
     if (userhome != NULL && *strcpy(cut_buf_name, userhome) != '\0') {
 	strcat(cut_buf_name, "/.xfig");
     } else {
-	sprintf(cut_buf_name, "%s/xfig%06d", TMPDIR, getpid());
+		int fd;
+		sprintf(cut_buf_name, "%s/xfig.XXXXXX", TMPDIR);
+		if ((fd = mkstemp(cut_buf_name)) == -1) {
+			fprintf(stderr, "Can't create temporary file for cut_buff: %s\n",
+					strerror(errno));
+			exit(0);
+		}
+		close(fd);
     }
 
     /*******************************************************************************/
diff -ur xfig.3.2.3d.orig/mode.c xfig.3.2.3d/mode.c
--- xfig.3.2.3d.orig/mode.c	Wed Mar 21 19:40:32 2001
+++ xfig.3.2.3d/mode.c	Fri Mar 22 09:38:45 2002
@@ -70,7 +70,7 @@
 
 int		cur_exp_lang;		/* gets initialized in main.c */
 Boolean		batch_exists = False;
-char		batch_file[32];
+char		batch_file[PATH_MAX];
 
 char	       *lang_items[] = {
 	"box",  "latex", "epic", "eepic", "eepicemu", "pictex",
diff -ur xfig.3.2.3d.orig/u_print.c xfig.3.2.3d/u_print.c
--- xfig.3.2.3d.orig/u_print.c	Mon Dec 11 20:52:38 2000
+++ xfig.3.2.3d/u_print.c	Fri Mar 22 12:53:38 2002
@@ -71,9 +71,16 @@
     char	    syspr[2*PATH_MAX+200];
     char	    tmpfile[PATH_MAX];
     char	   *name;
+	int fd;
 
-    sprintf(tmpfile, "%s/%s%06d", TMPDIR, "xfig-print", getpid());
+    snprintf(tmpfile, sizeof(tmpfile), "%s/xfig-print.XXXXXX", TMPDIR);
     warnexist = False;
+	if ((fd = mkstemp(tmpfile)) == -1) {
+		file_msg("Can't open temp file %s: %s\n", tmpfile, strerror(errno));
+		return;
+	}
+	close(fd);
+
     init_write_tmpfile();
     if (write_file(tmpfile, False)) {
       end_write_tmpfile();
@@ -181,14 +188,21 @@
     char	    tmp_name[PATH_MAX];
     char	    tmp_fig_file[PATH_MAX];
     char	   *outfile, *name, *real_lang;
+	int fd;
 
     /* if file exists, ask if ok */
     if (!ok_to_write(file, "EXPORT"))
 	return (1);
 
-    sprintf(tmp_fig_file, "%s/%s%06d", TMPDIR, "xfig-fig", getpid());
-    /* write the fig objects to a temporary file */
+    snprintf(tmp_fig_file, sizeof(tmp_fig_file), "%s/xfig-fig.XXXXXX", TMPDIR);
     warnexist = False;
+	if ((fd = mkstemp(tmp_fig_file)) == -1) {
+		file_msg("Can't open temp file %s: %s\n", tmp_fig_file,
+				 strerror(errno));
+		return 1;
+	}
+	close(fd);
+
     init_write_tmpfile();
     if (write_file(tmp_fig_file, False)) {
       end_write_tmpfile();
@@ -389,10 +403,16 @@
     char   errfname[PATH_MAX];
     FILE  *errfile;
     char   str[400];
-    int	   status;
+    int	   status, fd;
 
     /* make temp filename for any errors */
-    sprintf(errfname, "%s/xfig-export%06d.err", TMPDIR, getpid());
+    snprintf(errfname, sizeof(errfname), "%s/xfig-export.XXXXXX", TMPDIR);
+    if ((fd = mkstemp(errfname)) == -1) {
+	file_msg("Can't open temp file %s: %s\n", errfname, strerror(errno));
+	return 1;
+    }
+    close(fd);
+    
     /* direct any output from fig2dev to this file */
     strcat(command, " 2> "); 
     strcat(command, errfname); 
diff -ur xfig.3.2.3d.orig/w_print.c xfig.3.2.3d/w_print.c
--- xfig.3.2.3d.orig/w_print.c	Wed Dec 13 01:08:56 2000
+++ xfig.3.2.3d/w_print.c	Fri Mar 22 15:37:25 2002
@@ -286,10 +286,10 @@
     Widget	    w;
 {
 	FILE	   *infp,*outfp;
-	char	    tmp_exp_file[32];
+	char	    tmp_exp_file[PATH_MAX];
 	char	    str[255];
 	char	    backgrnd[10], grid[80];
-
+	int fd;
 	if (writing_batch || emptyfigure_msg(print_msg))
 		return;
 
@@ -297,11 +297,20 @@
 	/* this could happen if the user presses the button too fast */
 	writing_batch = True;
 
-	/* make a temporary name to write the batch stuff to */
-	sprintf(batch_file, "%s/%s%06d", TMPDIR, "xfig-batch", getpid());
 	/* make a temporary name to write this figure to */
-	sprintf(tmp_exp_file, "%s/%s%06d", TMPDIR, "xfig-exp", getpid());
-	batch_exists = True;
+	snprintf(tmp_exp_file, sizeof(tmp_exp_file), "%s/xfig-exp.XXXXXX",
+		TMPDIR);
+
+	if (batch_exists != True) {
+		/* make a temporary name to write the batch stuff to */
+		sprintf(batch_file, "%s/xfig-batch.XXXXXX", TMPDIR);
+		if ((fd = mkstemp(batch_file)) == -1) {
+			file_msg("Error creating temporary file");
+			return;
+		}
+		close(fd);
+		batch_exists = True;
+	}
 	if (!print_popup) 
 		create_print_panel(w);
 
@@ -313,6 +322,12 @@
 
 	/* make a #rrggbb string from the background color */
 	make_rgb_string(export_background_color, backgrnd);
+
+	if ((fd = mkstemp(tmp_exp_file)) == -1) {
+		file_msg("Error creating temporary file");
+		return;
+	}
+	close(fd);
 
 	print_to_file(tmp_exp_file, "ps", appres.magnification, 0, 0, backgrnd,
 				NULL, FALSE, print_all_layers, 0, FALSE);
diff -ur xfig.3.2.3d.orig/w_srchrepl.c xfig.3.2.3d/w_srchrepl.c
--- xfig.3.2.3d.orig/w_srchrepl.c	Mon Sep 11 19:23:31 2000
+++ xfig.3.2.3d/w_srchrepl.c	Fri Mar 22 08:26:45 2002
@@ -777,7 +777,7 @@
   char	 *cmd;
   char	  str[300];
   FILE	 *fp;
-  int	  len, i;
+  int	  len, i, fd;
   Boolean done = FALSE;
   static int lines = 0;
 
@@ -790,9 +790,12 @@
   }
   lines = 0;
 
-  sprintf(filename, "%s/xfig-spell.%d", TMPDIR, (int)getpid());
-  fp = fopen(filename, "w");
-  if (fp == NULL) {
+  snprintf(filename, sizeof(filename), "%s/xfig-spell.XXXXXX", TMPDIR);
+  if ((fd = mkstemp(filename)) == -1 || (fp = fdopen(fd, "w")) == NULL) {
+    if (fd != -1) {
+	unlink(filename);
+	close(fd);
+    }
     file_msg("Can't open temporary file: %s: %s\n", filename, strerror(errno));
   } else {
     /* locate all text objects and write them to file fp */
